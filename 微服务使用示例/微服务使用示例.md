# 微服务使用示例

## 1.网络准备

创建私有网络

![1569553506171](image\1569553506171.png)

CIDR选择默认：10.0.0.0/16

![1569569300128](image\1569569300128.png)

## 2.微服务配置

### 1.资源管理

#### 1.1创建注册中心

```
首先创建注册中心
```

![1569554152217](image\1569554152217.png)

```
选择刚才创建的工作组网络
```

注册中心创建成功后

![1569565859577](image\1569565859577.png)

点击详细查看注册中心地址：

![1569565896426](image\1569565896426.png)

```
记录eureka信息:
http://reg.eureka-0.center-w8t9t6hnm.com:8761	
http://reg.eureka-1.center-w8t9t6hnm.com:8762
http://reg.eureka-2.center-w8t9t6hnm.com:8763
```

#### 1.2创建工作组

1.2.1创建子网

![img](image\1569563382744_src)

创建子网成功

![1569569641408](image\1569569641408.png)

1.2.2 创建云主机资源

```
云主机资源（目前支持）
​	镜像：CentOS 7.6 64位
​	需绑定弹性公网IP
​	使用刚才创建的子网
​	安全组选择【默认安全组开放全部端口】
```

![img](image\1569563458376_src)

创建云主机成功：

![1569569710496](image\1569569710496.png)

```
创建云主机成功后查看公网IP是否正常，后续步骤中会涉及远程到云主机资源中做相应的操作；
```

1.2.3 创建工作组

![1569565307966](image\1569565307966.png)

```
1.选择刚才创建的云主机资源
2.下图命令请远程到选中的云主机中执行
```

![1569565343485](image\1569565343485.png)

```
3.远程到已选择的云主机执行下面命令：
执行：wget -c https://microservice.s3.cn-east-2.jdcloud-oss.com/getPublickey.sh -P /root && bash /root/getPublickey.sh https://microservice.s3.cn-east-2.jdcloud-oss.com/registry
提示：具体命令已实际系统中命令为准
```

![1569555032466](image\1569555032466.png)

```
执行成功见上图
```

创建工作组成功：

![1569569977076](image\1569569977076.png)

### 2.应用管理

#### 2.1创建命名空间

![1569555146725](image\1569555146725.png)

![1569570024088](image\1569570024088.png)

#### 2.2创建应用管理

![img](image/1569562465464_src) 

```
选择运行环境：Java
选择Java版本：jre8
选择部署方式：Jar包
```

![1569570059745](image\1569570059745.png)

3.软件中心管理

1.创建软件仓库 

![img](image\1569562832810_src)

2.上传应用jar（测试jar详情见下方[**2.1构建测试应用**]）

![img](image\1569563035473_src)

![img](image\1569563056056_src)

2.1.构建测试应用

![1569557267293](image\1569557267293.png)

![1569557809379](image\1569557809379.png)

application.yml

```
#端口号
spring:
  application:
    name: spring-cloud-book-service
  profiles:
    active: test
server:
  port: 8880

test:
  version: 0.0.1

eureka:
  instance:
    preferIpAddress: true
  client:
    service-url:
    # 配置刚才创建的注册中心中eureka地址
      defaultZone: http://reg.eureka-0.center-w8t9t6hnm.com:8761/eureka/
    register-with-eureka: true
```

构建自己的jar

![1569566091609](image\1569566091609.png)

#### 2.3应用发布

![1569566265356](image\1569566265356.png)

 ![img](image\1569563706396_src)

![img](image\1569563739386_src)

![1569566403332](image\1569566403332.png)

#### 2.4应用发布成功后验证

```
第一步：
查看在创建工作组时创建的云主机资源的弹性公网IP
114.67.111.182
114.67.111.173
第二步：
访问测试应用【ip:测试应用端口/API接口】
http://114.67.111.173:8880/getVersion
```

![1569566611663](image\1569566611663.png)

![1569569234189](image\1569569234189.png)

### 3.配置管理

#### 1.应用配置

1.1创建应用配置

![1569567286128](image\1569567286128.png)

![1569567409384](image\1569567409384.png)

1.2.配置当前配置文件到测试应用

![1569567615040](image\1569567615040.png)

![1569567663659](image\1569567663659.png)

1.3.验证配置文件是否成功

![1569568725791](image\1569568725791.png)

```
端口：8881
版本：0.1.1
```

#### 2.回滚

![1569570377172](image\1569570377172.png)

![1569570419486](image\1569570419486.png)

回滚后验证：

![1569570487280](image\1569570487280.png)

#### 3.全局配置

3.1.创建全局配置文件

![1569567922620](image\1569567922620.png)

3.2.点击发布

![1569568032797](image\1569568032797.png)

3.3.验证发布

![1569567962976](image\1569567962976.png)
